# Querying Data with LINQ

Imagine you have a huge library with thousands of books. LINQ is like having a super-smart librarian who can find exactly what you need instantly! Instead of saying "find books," you can say "find all mystery books written after 2020 with more than 300 pages" - and LINQ gets them for you!

---

## Section 1: Introduction to LINQ

### What is LINQ?

**LINQ** (Language Integrated Query) lets you ask questions about your data using C# code. EF Core then translates your questions into SQL that the database understands.

> **Think of it this way:**
>
> You speak C#, the database speaks SQL, and LINQ is your translator that converts your requests perfectly!

<EntityFrameworkVisualizer mode="beginner" />

## Your First Query

<DotnetCodePreview
  title="Basic LINQ Query"
  code={`// Get all blogs
var allBlogs = context.Blogs.ToList();

// Get blogs with "Tech" in the title
var techBlogs = context.Blogs
.Where(b => b.Title.Contains("Tech"))
.ToList();

// Get just one blog by ID
var blog = context.Blogs.Find(1);`}
steps={[
{
lineNumbers: [2],
highlight: "Get everything",
explanation: "ToList() fetches all blogs from the database"
},
{
lineNumbers: [5, 6, 7],
highlight: "Filter with Where",
explanation: "Where() is like a sieve - only matching items get through"
},
{
lineNumbers: [10],
highlight: "Find by ID",
explanation: "Find() is a shortcut to get one item by its primary key"
}
]}
/>

## Common Query Operations

| What You Want   | LINQ Method         | Example                   |
| :-------------- | :------------------ | :------------------------ |
| Filter items    | `.Where()`          | Only blogs with 5+ rating |
| Sort items      | `.OrderBy()`        | Sort by date              |
| Get first item  | `.FirstOrDefault()` | Get newest blog           |
| Count items     | `.Count()`          | How many posts?           |
| Check if exists | `.Any()`            | Are there any posts?      |

## Sorting Your Results

<DotnetCodePreview
  title="Sorting with OrderBy"
  code={`// Sort A to Z by title
var sorted = context.Blogs
    .OrderBy(b => b.Title)
    .ToList();

// Sort newest first
var newest = context.Blogs
.OrderByDescending(b => b.CreatedDate)
.ToList();`}
steps={[
{
lineNumbers: [2, 3, 4],
highlight: "OrderBy",
explanation: "Sorts in ascending order (A→Z, 1→10)"
},
{
lineNumbers: [7, 8, 9],
highlight: "OrderByDescending",
explanation: "Sorts in descending order (Z→A, newest first)"
}
]}
/>

## Getting Just One Item

<DotnetCodePreview
  title="Single Item Queries"
  code={`// Get first blog (or null if none exist)
var first = context.Blogs.FirstOrDefault();

// Get first blog matching condition
var techBlog = context.Blogs
.FirstOrDefault(b => b.Title.Contains("Tech"));

// Get single item (throws if more than one!)
var unique = context.Blogs
.SingleOrDefault(b => b.Id == 5);`}
steps={[
{
lineNumbers: [2],
highlight: "FirstOrDefault",
explanation: "Gets the first item, or null if nothing found"
},
{
lineNumbers: [9, 10],
highlight: "SingleOrDefault",
explanation: "Like First, but throws an error if there are multiple matches"
}
]}
/>

<ProgressCheckpoint section="intro-linq" xpReward={8} />

---

## Section 2: Projections

### Selecting Specific Data

Instead of getting entire objects, you can select just what you need:

<DotnetCodePreview
  title="Basic Projections"
  code={`// Get only titles (not entire Blog objects)
var titles = context.Blogs
    .Select(b => b.Title)
    .ToList();

// Get multiple fields
var blogInfo = context.Blogs
    .Select(b => new { b.Title, b.Url })
    .ToList();

// Use the results
foreach (var info in blogInfo)
{
    Console.WriteLine($"{info.Title}: {info.Url}");
}`}
  steps={[
    {
      lineNumbers: [2, 3, 4],
      highlight: "Select one field",
      explanation: "Only the Title column is fetched from the database"
    },
    {
      lineNumbers: [7, 8, 9],
      highlight: "Anonymous type",
      explanation: "Create objects with just the fields you need"
    }
  ]}
/>

### Why Use Projections?

| Without Projection | With Projection |
|:-------------------|:----------------|
| Fetches ALL columns | Fetches only needed columns |
| More data transfer | Less data transfer |
| Slower queries | Faster queries |
| More memory used | Less memory used |

<ProgressCheckpoint section="projections" xpReward={9} />

---

## Section 3: Eager Loading

### Loading Related Data

When you have related data (like a Blog with Posts), you need to tell EF Core to load it:

<DotnetCodePreview
  title="Include Related Data"
  code={`// Without Include - Posts will be null!
var blog = context.Blogs.FirstOrDefault();
Console.WriteLine(blog.Posts.Count);  // Error or 0!

// With Include - Posts are loaded
var blogWithPosts = context.Blogs
    .Include(b => b.Posts)
    .FirstOrDefault();
Console.WriteLine(blogWithPosts.Posts.Count);  // Works!`}
  steps={[
    {
      lineNumbers: [2, 3],
      highlight: "Without Include",
      explanation: "Related data is NOT loaded automatically"
    },
    {
      lineNumbers: [6, 7, 8, 9],
      highlight: "With Include",
      explanation: "Include() tells EF Core to load the Posts collection"
    }
  ]}
/>

### Multiple Includes

```csharp
// Include multiple related collections
var fullBlog = context.Blogs
    .Include(b => b.Posts)
    .Include(b => b.Author)
    .FirstOrDefault();

// Now both Posts and Author are loaded!
Console.WriteLine($"Author: {fullBlog.Author.Name}");
Console.WriteLine($"Posts: {fullBlog.Posts.Count}");
```

### Nested Includes

```csharp
// Include Posts, and for each Post, include Comments
var blogWithComments = context.Blogs
    .Include(b => b.Posts)
        .ThenInclude(p => p.Comments)
    .FirstOrDefault();

// Access nested data
foreach (var post in blogWithComments.Posts)
{
    Console.WriteLine($"Post: {post.Title}");
    Console.WriteLine($"  Comments: {post.Comments.Count}");
}
```

<InfoBox type="tip">
  **Pro Tip:** Only Include what you need! Loading too much related data can slow down your queries.
</InfoBox>

## Quick Summary

- **LINQ** = Asking questions about data in C#
- **Where()** = Filter (keep only matching items)
- **OrderBy()** = Sort results
- **ToList()** = Execute query and get results
- **FirstOrDefault()** = Get one item (or null)
- **Select()** = Choose specific fields (projection)
- **Include()** = Load related data (eager loading)

<ProgressCheckpoint section="eager-loading" xpReward={8} />
